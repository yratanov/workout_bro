<% supersets = user_supersets %>
<% has_running_set = workout_set.workout.workout_sets.any?(&:running?) %>
<% next_item = next_routine_item_for_workout(workout_set.workout) %>

<div
  data-controller="superset-form"
  data-superset-form-default-tab-value="<%= next_item.is_superset ? 'superset' : 'exercise' %>"
  class="space-y-3"
>
  <% if supersets.any? %>
    <div class="flex gap-2 mb-3">
      <button
        type="button"
        class="px-3 py-1 rounded text-sm transition-colors"
        data-superset-form-target="exerciseTab"
        data-action="click->superset-form#showExercise"
        data-active-class="bg-blue-600 text-white"
        data-inactive-class="bg-slate-700 text-slate-300 hover:bg-slate-600"
      >
        <%= t("workout_sets.form.single_exercise") %>
      </button>
      <button
        type="button"
        class="px-3 py-1 rounded text-sm transition-colors"
        data-superset-form-target="supersetTab"
        data-action="click->superset-form#showSuperset"
        data-active-class="bg-blue-600 text-white"
        data-inactive-class="bg-slate-700 text-slate-300 hover:bg-slate-600"
      >
        <%= t("workout_sets.form.superset") %>
      </button>
    </div>
  <% end %>

  <div
    data-superset-form-target="exercisePane"
    class="flex items-center gap-3 flex-wrap"
  >
    <%= app_form_with(model: workout_set, class: "contents") do |form| %>
      <% if workout_set.errors.any? %>
        <div class="w-full bg-red-900/50 text-red-200 px-2 py-1 text-sm rounded mb-2">
          <%= workout_set.errors.full_messages.join(", ") %>
        </div>
      <% end %>
      <%= form.hidden_field :workout_id %>
      <%= form.collection_select(
        :exercise_id,
        available_exercises_for_workout_set(workout_set),
        :id,
        :name,
        { selected: next_item.exercise_id },
        {
          class:
            "border flex-1 min-w-[200px] border-slate-500 bg-slate-600 text-white px-3 py-2 rounded",
        },
      ) %>
      <%= button text: t("workout_sets.form.start"),
      type: "submit",
      style: "primary",
      disabled: has_running_set %>
    <% end %>
  </div>

  <% if supersets.any? %>
    <div
      data-superset-form-target="supersetPane"
      class="hidden flex items-center gap-3 flex-wrap"
    >
      <%= form_with url: start_superset_workout_sets_path, method: :post, class: "contents" do |form| %>
        <%= form.hidden_field :workout_id, value: workout_set.workout_id %>
        <%= form.collection_select(
          :superset_id,
          supersets,
          :id,
          :name,
          { selected: next_item.superset_id },
          {
            class:
              "border flex-1 min-w-[200px] border-slate-500 bg-slate-600 text-white px-3 py-2 rounded",
          },
        ) %>
        <%= button text: t("workout_sets.form.start_superset"),
        type: "submit",
        style: "primary",
        disabled: has_running_set %>
      <% end %>
    </div>
  <% end %>

  <% last_completed_set = last_completed_workout_set(workout_set.workout) %>
  <% if last_completed_set %>
    <%= button t("workout_sets.form.reopen_prev"),
    style: "outlined",
    method: :post,
    route: reopen_workout_set_path(last_completed_set) %>
  <% end %>
</div>
