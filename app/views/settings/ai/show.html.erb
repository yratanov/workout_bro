<% content_for :title, t(".title") %>

<div class="w-full max-w-4xl">
  <h1 class="font-bold text-2xl mb-4 sm:mb-6"><%= t(".title") %></h1>

  <div class="flex flex-col sm:flex-row gap-4 sm:gap-8">
    <%= render SettingsMenuComponent.new(current_page: :ai) %>

    <div class="flex-1 min-w-0">
      <div class="bg-slate-800 rounded-lg p-4 sm:p-6">
        <h2 class="font-semibold text-lg mb-4"><%= t(".ai_configuration") %></h2>

        <%= app_form_with model: @user,
                          url: settings_ai_path,
                          method: :patch,
                          class: "space-y-6",
                          data: {
                            controller: "ai-settings",
                            ai_settings_models_value: @models.to_json,
                          } do |form| %>
          <%= form.input :ai_provider,
                     as: :select,
                     label: t(".provider_label"),
                     margin: "",
                     include_blank: t(".select_provider"),
                     collection: @providers.map { |p| [p[:label], p[:key]] },
                     input_html: {
                       data: {
                         action: "change->ai-settings#providerChanged",
                         ai_settings_target: "providerSelect",
                       },
                     } %>

          <div
            data-ai-settings-target="modelContainer"
            class="space-y-6 <%= "hidden" unless @user.ai_provider.present? %>"
          >
            <%= form.input :ai_model,
                       as: :select,
                       label: t(".model_label"),
                       margin: "",
                       collection: (@models[@user.ai_provider] || []).map { |m| [m, m] },
                       input_html: {
                         data: {
                           ai_settings_target: "modelSelect",
                         },
                       } %>

            <div>
              <%= form.input :ai_api_key,
                         as: :password,
                         label: t(".api_key_label"),
                         margin: "",
                         input_html: {
                           autocomplete: "off",
                           placeholder: t(".api_key_placeholder"),
                         } %>
              <% if @user.ai_api_key.present? %>
                <p class="mt-1 text-sm text-slate-400"><%= t(".api_key_hint") %></p>
              <% end %>
            </div>
          </div>

          <div class="pt-2">
            <%= button text: t(".save"), type: "submit", style: "primary" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
