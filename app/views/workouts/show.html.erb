<% content_for :title, "Workout" %>

<div class="w-full max-w-xl text-lg">
  <div class="flex items-center justify-between mb-4">
    <div class="flex items-center gap-2 text-xl">
      <% if @workout.workout_routine_day %>
        <span class="font-semibold"><%= @workout.workout_routine_day.workout_routine.name %></span>
        <span class="text-slate-400">Â·</span>
        <span><%= @workout.workout_routine_day.name %></span>
      <% else %>
        <span class="font-semibold">Workout</span>
      <% end %>
    </div>
    <div class="flex items-center gap-3 text-base text-slate-300">
      <span><%= @workout.created_at.strftime("%d %b") %></span>
      <span class="text-slate-500">|</span>
      <%= render(
        TimerComponent.new(
          started_at: @workout.started_at,
          ended_at: @workout.ended_at,
          show_hours: true,
          paused_at: @workout.paused_at,
          total_paused_seconds: @workout.total_paused_seconds
        ),
      ) %>
    </div>
  </div>

  <% if @workout.strength? %>
    <div class="relative">
      <% if @workout.paused? %>
        <div class="absolute inset-0 z-10 flex items-center justify-center border-2 border-red-400 rounded bg-gray-500/60 backdrop-blur-sm">
          <%= link_to resume_workout_path(@workout),
            method: :post,
            data: { turbo_method: :post },
            class: "group cursor-pointer p-4" do %>
            <svg class="w-16 h-16 text-red-400 group-hover:hidden" fill="currentColor" viewBox="0 0 24 24">
              <rect x="6" y="4" width="4" height="16" rx="1" />
              <rect x="14" y="4" width="4" height="16" rx="1" />
            </svg>
            <svg class="w-16 h-16 text-green-400 hidden group-hover:block" fill="currentColor" viewBox="0 0 24 24">
              <path d="M8 5v14l11-7z" />
            </svg>
          <% end %>
        </div>
      <% end %>

      <%= turbo_frame_tag ["workout_sets"] do %>
        <div class="space-y-3">
          <% @workout.workout_sets.each do |set| %>
            <%= render set %>
          <% end %>
        </div>
      <% end %>

      <% unless @workout.ended? %>
        <div class="mt-3">
          <%= turbo_frame_tag ["new_workout_set"] do %>
            <% if @workout.workout_sets.none?(&:running?) %>
              <%= render "workout_sets/form", workout_set: WorkoutSet.new(workout: @workout) %>
            <% end %>
          <% end %>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="bg-slate-800 rounded-lg p-4 mb-4">
      <div class="grid grid-cols-2 gap-4 text-center">
        <div>
          <div class="text-slate-400 text-sm">Distance</div>
          <div class="text-xl font-semibold"><%= @workout.distance.to_f / 1000 %> km</div>
        </div>
        <div>
          <div class="text-slate-400 text-sm">Avg Pace</div>
          <div class="text-xl font-semibold"><%= run_pace @workout %></div>
        </div>
      </div>
    </div>
  <% end %>

  <div class="flex gap-3 mt-4">
    <% if @workout.ended? %>
      <%= button "Back", type: "link", style: "outlined", route: workouts_path %>
      <%= button "Destroy",
      style: "danger",
      method: :delete,
      route: workout_path(@workout),
      data: {
        turbo_confirm: "Are you sure?",
      } %>
    <% else %>
      <% if @workout.paused? %>
        <%= button "Resume",
        style: "success",
        route: resume_workout_path(@workout),
        method: :post,
        data: { turbo_method: :post } %>
      <% else %>
        <%= button "Pause",
        style: "outlined",
        route: pause_workout_path(@workout),
        method: :post,
        data: { turbo_method: :post } %>
      <% end %>
      <%= button "Finish workout",
      style: "primary",
      route: stop_workout_path(@workout),
      method: :post,
      data: {
        turbo_method: :post,
        turbo_confirm: "Are you sure?",
      } %>
    <% end %>
  </div>
</div>
