<% content_for :title, "Workout" %>

<div>
  <% if notice.present? %>
    <p
      class="
        py-2 px-3 bg-green-50 mb-5 text-green-500 font-medium rounded-md inline-block
      "
      id="notice"
    ><%= notice %></p>
  <% end %>

  <div class="lg:min-w-[600px] flex gap-4 items-center mb-5 text-xl">
    <% if @workout.workout_routine_day %>
      <div>
        <%= @workout.workout_routine_day.workout_routine.name %>
      </div>
      <div>
        ·
      </div>
      <div>
        <%= @workout.workout_routine_day.name %>
      </div>
    <% else %>
      <div>
        Workout
      </div>
    <% end %>
    <div>
      ·
    </div>
    <div>
      <%= @workout.created_at.strftime("%d %b") %>
    </div>
    <div>
      ·
    </div>
    <%= render(
      TimerComponent.new(
        started_at: @workout.started_at,
        ended_at: @workout.ended_at,
        show_hours: true,
        paused_at: @workout.paused_at,
        total_paused_seconds: @workout.total_paused_seconds
      ),
    ) %>
  </div>

  <% if @workout.strength? %>
    <div class="relative">
      <% if @workout.paused? %>
        <div class="absolute inset-0 z-10 flex items-center justify-center border-2 border-red-400 rounded bg-gray-500/60 backdrop-blur-sm">
          <%= link_to resume_workout_path(@workout),
            method: :post,
            data: { turbo_method: :post },
            class: "group cursor-pointer p-4" do %>
            <svg class="w-16 h-16 text-red-400 group-hover:hidden" fill="currentColor" viewBox="0 0 24 24">
              <rect x="6" y="4" width="4" height="16" rx="1" />
              <rect x="14" y="4" width="4" height="16" rx="1" />
            </svg>
            <svg class="w-16 h-16 text-green-400 hidden group-hover:block" fill="currentColor" viewBox="0 0 24 24">
              <path d="M8 5v14l11-7z" />
            </svg>
          <% end %>
        </div>
      <% end %>

      <%= turbo_frame_tag ["workout_sets"] do %>
        <% @workout.workout_sets.each do |set| %>
          <div class="mb-5">
            <%= render set %>
          </div>
        <% end %>
      <% end %>

      <% unless @workout.ended? %>
        <div class="mb-5">
          <%= turbo_frame_tag ["new_workout_set"] do %>
            <% if @workout.workout_sets.none?(&:running?) %>
              <%= render "workout_sets/form", workout_set: WorkoutSet.new(workout: @workout) %>
            <% end %>
          <% end %>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="mb-5">
      Distance:
      <%= @workout.distance.to_f / 1000 %>
      km
    </div>
    <div class="mb-5">
      Average pace:
      <%= run_pace @workout %>
    </div>
  <% end %>

  <div class="flex gap-4">
    <% if @workout.ended? %>
      <%= button "Back", type: "link", style: "outlined", route: workouts_path %>
      <%= button "Destroy",
      style: "danger",
      method: :delete,
      route: workout_path(@workout),
      data: {
        turbo_confirm: "Are you sure?",
      } %>
    <% else %>
      <% if @workout.paused? %>
        <%= button "Resume",
        style: "success",
        route: resume_workout_path(@workout),
        method: :post,
        data: { turbo_method: :post } %>
      <% else %>
        <%= button "Pause",
        style: "outlined",
        route: pause_workout_path(@workout),
        method: :post,
        data: { turbo_method: :post } %>
      <% end %>
      <%= button "Finish workout",
      style: "primary",
      route: stop_workout_path(@workout),
      method: :post,
      data: {
        turbo_method: :post,
        turbo_confirm: "Are you sure?",
      } %>
    <% end %>
  </div>
</div>
