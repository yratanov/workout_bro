<% content_for :title, t(".title") %>

<%= turbo_frame_tag "previous_history_modal" %>

<div class="w-full max-w-xl">
  <div class="flex items-center justify-between mb-4">
    <div class="flex items-center gap-2 text-xl">
      <% if @workout.workout_routine_day %>
        <span class="font-semibold"><%= @workout.workout_routine_day.workout_routine.name %></span>
        <span class="text-slate-400">Â·</span>
        <span><%= @workout.workout_routine_day.name %></span>
      <% else %>
        <span class="font-semibold"><%= t(".title") %></span>
      <% end %>
    </div>
    <div class="flex items-center gap-3 text-base text-slate-300">
      <span><%= @workout.created_at.strftime("%d %b") %></span>
      <span class="text-slate-500">|</span>
      <%= render(
        TimerComponent.new(
          started_at: @workout.started_at,
          ended_at: @workout.ended_at,
          show_hours: true,
          paused_at: @workout.paused_at,
          total_paused_seconds: @workout.total_paused_seconds,
        ),
      ) %>
      <span class="text-slate-500">|</span>
      <%= link_to notes_modal_workout_path(@workout),
        class: "p-1 text-slate-400 hover:text-blue-400 transition-colors",
        data: { turbo_frame: "notes_modal" },
        title: t("shared.buttons.add_note") do %>
        <%= icon "note", size: "w-5 h-5" %>
      <% end %>
    </div>
  </div>

  <% if @workout.strength? %>
    <div class="relative">
      <% if @workout.paused? %>
        <div
          class="
            absolute inset-0 z-10 flex items-center justify-center border-2 border-red-400
            rounded bg-gray-500/60 backdrop-blur-sm
          "
        >
          <%= link_to resume_workout_path(@workout),
            method: :post,
            data: { turbo_method: :post },
            class: "group cursor-pointer p-4" do %>
            <span class="text-red-400 group-hover:hidden"><%= icon "pause", size: "w-16 h-16" %></span>
            <span class="text-green-400 hidden group-hover:block"><%= icon "play", size: "w-16 h-16" %></span>
          <% end %>
        </div>
      <% end %>

      <%= turbo_frame_tag ["workout_sets"] do %>
        <%= render "workout_sets/list", workout: @workout %>
      <% end %>

      <% unless @workout.ended? %>
        <div class="mt-3">
          <%= turbo_frame_tag ["new_workout_set"] do %>
            <% if @workout.workout_sets.none?(&:running?) %>
              <%= render "workout_sets/form", workout_set: WorkoutSet.new(workout: @workout) %>
            <% end %>
          <% end %>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="bg-slate-800 rounded-lg p-4 mb-4">
      <div class="grid grid-cols-2 gap-4 text-center">
        <div>
          <div class="text-slate-400 text-sm"><%= t(".distance") %></div>
          <div class="text-xl font-semibold"><%= @workout.distance.to_f / 1000 %>
            km</div>
        </div>
        <div>
          <div class="text-slate-400 text-sm"><%= t(".avg_pace") %></div>
          <div class="text-xl font-semibold"><%= run_pace @workout %></div>
        </div>
      </div>
    </div>
    <%= render partial: "workouts/notes",
    locals: {
      workout: @workout,
      edit_path: notes_modal_workout_path(@workout),
    } %>
  <% end %>

  <div class="h-20"></div>
  <div id="rest-timer-container"></div>
  <div
    class="
      fixed bottom-0 left-0 right-0 bg-slate-800 border-t border-slate-700 p-4
    "
  >
    <div class="max-w-xl mx-auto flex gap-3 justify-center">
      <% if @workout.ended? %>
        <%= button t("shared.buttons.back"),
        type: "link",
        style: "outlined",
        route: workouts_path %>
        <%= button t("shared.buttons.delete"),
        style: "danger",
        method: :delete,
        route: workout_path(@workout),
        data: {
          turbo_confirm: t("shared.confirmations.are_you_sure"),
        } %>
      <% else %>
        <% if @workout.paused? %>
          <%= button t(".resume"),
          style: "success",
          route: resume_workout_path(@workout),
          method: :post,
          data: {
            turbo_method: :post,
          } %>
        <% else %>
          <%= button t(".pause"),
          style: "outlined",
          route: pause_workout_path(@workout),
          method: :post,
          data: {
            turbo_method: :post,
          } %>
        <% end %>
        <%= button t(".finish"),
        style: "primary",
        route: stop_workout_path(@workout),
        method: :post,
        data: {
          turbo_method: :post,
          turbo_confirm: t("shared.confirmations.are_you_sure"),
        } %>
      <% end %>
    </div>
  </div>
</div>
